<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Application de gestion d'√©quipe de football pour Meyrin FF14 - Gestion des joueuses, matchs, entra√Ænements et tactiques">
    <title>Meyrin FF14</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Ic√¥nes pour iOS -->
    <link rel="apple-touch-icon" href="meyrin_logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="meyrin_logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="meyrin_logo.png">
    <link rel="apple-touch-icon" sizes="167x167" href="meyrin_logo.png">
    
    <!-- Ic√¥ne pour Android/Chrome -->
    <link rel="icon" type="image/png" href="meyrin_logo.png">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>
                <img src="meyrin_logo.png" alt="Meyrin FF14 Logo" class="logo" onerror="this.style.display='none'">
                Meyrin FF14
            </h1>
            <nav>
                <button class="nav-btn active" data-view="joueurs">Joueurs</button>
                <button class="nav-btn" data-view="equipes">√âquipes</button>
                <button class="nav-btn" data-view="entrainements">Entra√Ænements</button>
                <button class="nav-btn" data-view="matchs">Matchs</button>
                <button class="nav-btn" data-view="tactiques">Tactiques</button>
                <button class="nav-btn" data-view="classement">Classement</button>
                <button class="nav-btn" data-view="performances">Performances</button>
                <button class="nav-btn" data-view="sauvegarde">üíæ Sauvegarde</button>
            </nav>
        </header>

        <main>
            <section id="joueurs-view" class="view active">
                <div class="view-header">
                    <h2>Gestion des Joueurs</h2>
                    <button class="btn-primary" onclick="openPlayerModal()">+ Ajouter un joueur</button>
                </div>
                <div class="players-grid" id="players-list"></div>
            </section>

            <section id="equipes-view" class="view">
                <div class="view-header">
                    <h2>Gestion des √âquipes</h2>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="team-card">
                        <h3 style="color: #FFA500; margin-bottom: 20px;">‚öΩ Meyrin 1</h3>
                        <div id="team1-list" class="team-players-list"></div>
                    </div>
                    <div class="team-card">
                        <h3 style="color: #FFA500; margin-bottom: 20px;">‚öΩ Meyrin 2</h3>
                        <div id="team2-list" class="team-players-list"></div>
                    </div>
                    <div class="team-card">
                        <h3 style="color: #FFA500; margin-bottom: 20px;">‚öΩ FF17</h3>
                        <div id="ff17-list" class="team-players-list"></div>
                    </div>
                </div>
            </section>

            <section id="entrainements-view" class="view">
                <div class="view-header">
                    <h2>Gestion des Entra√Ænements</h2>
                    <div>
                        <button class="btn-secondary" onclick="app.showAttendanceHistory()" style="margin-right: 10px;">üìä Historique des pr√©sences</button>
                        <button class="btn-primary" onclick="openTrainingModal()">+ Planifier un entra√Ænement</button>
                    </div>
                </div>
                <div class="trainings-list" id="trainings-list"></div>
            </section>

            <section id="matchs-view" class="view">
                <div class="view-header">
                    <h2>Gestion des Matchs</h2>
                    <div>
                        <button class="btn-secondary" onclick="importChampionshipCalendar()" style="margin-right: 10px;">üìÖ Importer Calendrier</button>
                        <button class="btn-primary" onclick="openMatchModal()">+ Ajouter un match</button>
                    </div>
                </div>
                <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-secondary filter-btn active" onclick="app.filterMatches('all')">Tous</button>
                    <button class="btn-secondary filter-btn" onclick="app.filterMatches('team1')">Meyrin 1</button>
                    <button class="btn-secondary filter-btn" onclick="app.filterMatches('team2')">Meyrin 2</button>
                    <button class="btn-secondary filter-btn" onclick="app.filterMatches('ff17')">FF17</button>
                </div>
                <div class="matches-list" id="matches-list"></div>
            </section>

            <section id="performances-view" class="view">
                <div class="view-header">
                    <h2>Suivi des Performances</h2>
                </div>
                <div class="performances-container" id="performances-container"></div>
            </section>

            <section id="tactiques-view" class="view">
                <div class="view-header">
                    <h2>Tactiques et Strat√©gies</h2>
                    <button class="btn-primary" onclick="openTacticModal()">+ Cr√©er une tactique</button>
                </div>
                <div class="tactics-list" id="tactics-list"></div>
            </section>

            <section id="classement-view" class="view">
                <div class="view-header">
                    <h2>Classement du Championnat</h2>
                    <button class="btn-primary" onclick="app.updateStandings()">üîÑ Mettre √† jour</button>
                </div>
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #333; margin-bottom: 10px;">Juniores F√©minines FF-14 (9v9) - 1er Degr√©</h3>
                    <p style="color: #666;">Tour Printemps - Groupe 1</p>
                </div>
                <div id="standings-container"></div>
            </section>

            <section id="performances-view" class="view">
                <div class="view-header">
                    <h2>Suivi des Performances</h2>
                </div>
                <div class="performances-container" id="performances-container"></div>
            </section>

            <section id="sauvegarde-view" class="view">
                <div class="view-header">
                    <h2>üíæ Sauvegarde & Restauration</h2>
                </div>
                
                <div style="max-width: 800px; margin: 0 auto;">
                    <!-- Export Section -->
                    <div style="background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üì§ Exporter les donn√©es
                        </h3>
                        <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                            T√©l√©chargez une sauvegarde compl√®te de toutes vos donn√©es (joueuses, matchs, entra√Ænements, tactiques, classement).
                            Vous pourrez ensuite l'importer sur un autre appareil ou la conserver comme backup.
                        </p>
                        <button class="btn-primary" onclick="app.exportAllData()" style="width: 100%; padding: 15px; font-size: 16px;">
                            üì• T√©l√©charger la sauvegarde
                        </button>
                    </div>

                    <!-- Import Section -->
                    <div style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üì• Importer les donn√©es
                        </h3>
                        <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                            Restaurez vos donn√©es depuis un fichier de sauvegarde pr√©c√©dent.
                        </p>
                        <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <p style="color: #856404; font-weight: 500; margin: 0;">
                                ‚ö†Ô∏è <strong>Attention :</strong> L'importation remplacera TOUTES vos donn√©es actuelles !
                            </p>
                        </div>
                        <input type="file" id="import-file-input" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                        <button class="btn-secondary" onclick="document.getElementById('import-file-input').click()" style="width: 100%; padding: 15px; font-size: 16px;">
                            üìÇ Choisir un fichier de sauvegarde
                        </button>
                    </div>

                    <!-- Info Section -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-top: 30px;">
                        <h4 style="color: #333; margin-bottom: 10px;">üí° Comment √ßa marche ?</h4>
                        <ul style="color: #666; line-height: 1.8; padding-left: 20px;">
                            <li><strong>Sur PC :</strong> Exportez vos donn√©es et envoyez le fichier √† votre t√©l√©phone (email, WhatsApp, etc.)</li>
                            <li><strong>Sur t√©l√©phone :</strong> T√©l√©chargez le fichier, puis importez-le via cette page</li>
                            <li><strong>Backup r√©gulier :</strong> Exportez vos donn√©es chaque semaine pour √©viter toute perte</li>
                            <li><strong>Format :</strong> Le fichier est au format JSON et peut √™tre ouvert avec un √©diteur de texte</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="player-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePlayerModal()">&times;</span>
            <h2 id="player-modal-title">Ajouter un joueur</h2>
            <form id="player-form" onsubmit="savePlayer(event)">
                <input type="hidden" id="player-id">
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" id="player-name" required>
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <select id="player-position" required>
                        <option value="">S√©lectionner...</option>
                        <option value="Gardien">Gardien</option>
                        <option value="D√©fenseur">D√©fenseur</option>
                        <option value="Milieu">Milieu</option>
                        <option value="Attaquant">Attaquant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ann√©e de naissance</label>
                    <input type="number" id="player-birthyear" min="1950" max="2020" required>
                </div>
                <div class="form-group">
                    <label>T√©l√©phone</label>
                    <input type="tel" id="player-phone">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closePlayerModal()">Annuler</button>
                    <button type="submit" class="btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="training-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTrainingModal()">&times;</span>
            <h2 id="training-modal-title">Planifier un entra√Ænement</h2>
            <form id="training-form" onsubmit="saveTraining(event)">
                <input type="hidden" id="training-id">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="training-date" required>
                </div>
                <div class="form-group">
                    <label>Heure</label>
                    <input type="time" id="training-time" required>
                </div>
                <div class="form-group">
                    <label>Dur√©e (minutes)</label>
                    <input type="number" id="training-duration" min="15" step="15" value="90" required>
                </div>
                <div class="form-group">
                    <label>Lieu</label>
                    <input type="text" id="training-location" required>
                </div>
                <div class="form-group">
                    <label>Objectifs</label>
                    <textarea id="training-objectives" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeTrainingModal()">Annuler</button>
                    <button type="submit" class="btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="match-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMatchModal()">&times;</span>
            <h2 id="match-modal-title">Ajouter un match</h2>
            <form id="match-form" onsubmit="saveMatch(event)">
                <input type="hidden" id="match-id">
                <div class="form-group">
                    <label>√âquipe</label>
                    <select id="match-team" required>
                        <option value="">S√©lectionner l'√©quipe...</option>
                        <option value="team1">Meyrin 1</option>
                        <option value="team2">Meyrin 2</option>
                        <option value="ff17">FF17</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="match-date" required>
                </div>
                <div class="form-group">
                    <label>Heure</label>
                    <input type="time" id="match-time" required>
                </div>
                <div class="form-group">
                    <label>Adversaire</label>
                    <input type="text" id="match-opponent" required>
                </div>
                <div class="form-group">
                    <label>Lieu</label>
                    <input type="text" id="match-location" required>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="match-type" required>
                        <option value="Championnat">Championnat</option>
                        <option value="Coupe">Coupe</option>
                        <option value="Amical">Amical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Score (notre √©quipe)</label>
                    <input type="number" id="match-score-home" min="0">
                </div>
                <div class="form-group">
                    <label>Score (adversaire)</label>
                    <input type="number" id="match-score-away" min="0">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeMatchModal()">Annuler</button>
                    <button type="submit" class="btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="attendance-history-modal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeAttendanceHistoryModal()">&times;</span>
            <h2>Historique des Pr√©sences</h2>
            <div id="attendance-history-content"></div>
        </div>
    </div>

    <div id="match-stats-modal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeMatchStatsModal()">&times;</span>
            <h2 id="match-stats-title">Statistiques du match</h2>
            <div id="match-stats-content"></div>
        </div>
    </div>

    <div id="tactic-modal" class="modal">
        <div class="modal-content modal-xlarge">
            <span class="close" onclick="closeTacticModal()">&times;</span>
            <h2 id="tactic-modal-title">Cr√©er une tactique</h2>
            <form id="tactic-form" onsubmit="saveTactic(event)">
                <input type="hidden" id="tactic-id">
                
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
                    <!-- Informations g√©n√©rales -->
                    <div>
                        <div class="form-group">
                            <label>Nom de la tactique</label>
                            <input type="text" id="tactic-name" placeholder="Ex: 3-3-2 D√©fensive" required>
                        </div>
                        <div class="form-group">
                            <label>Formation (Foot 9x9)</label>
                            <select id="tactic-formation" required onchange="app.loadFormationTemplate(this.value)">
                                <option value="">S√©lectionner...</option>
                                <option value="3-3-2">3-3-2 (√âquilibr√©e)</option>
                                <option value="3-2-3">3-2-3 (Offensive)</option>
                                <option value="2-4-2">2-4-2 (Contr√¥le du milieu)</option>
                                <option value="2-3-3">2-3-3 (Tr√®s offensive)</option>
                                <option value="3-4-1">3-4-1 (D√©fensive)</option>
                                <option value="4-2-2">4-2-2 (D√©fensive solide)</option>
                                <option value="2-2-4">2-2-4 (Attaque totale)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Notes tactiques</label>
                            <textarea id="tactic-notes" rows="4" placeholder="Instructions et remarques..."></textarea>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px; color: #333;">Liste des joueuses</h4>
                            <div id="players-available-list" style="max-height: 300px; overflow-y: auto;">
                                <!-- Liste g√©n√©r√©e dynamiquement -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Terrain de foot -->
                    <div>
                        <h3 style="margin-bottom: 15px; color: #333;">Positionnement sur le terrain</h3>
                        <div id="football-field" class="football-field">
                            <!-- Les positions seront g√©n√©r√©es dynamiquement -->
                        </div>
                        <p style="color: #666; font-size: 14px; margin-top: 10px; font-style: italic;">
                            üí° Glissez-d√©posez les joueuses de la liste vers les positions sur le terrain
                        </p>
                    </div>
                </div>
                
                <div class="form-actions" style="margin-top: 30px;">
                    <button type="button" class="btn-secondary" onclick="closeTacticModal()">Annuler</button>
                    <button type="submit" class="btn-primary">Enregistrer la tactique</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="calendar_import.js"></script>
    <script>
        // Fonction pour g√©rer l'importation de fichier
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (file) {
                app.importAllData(file);
            }
            // Reset l'input pour permettre de r√©-importer le m√™me fichier
            event.target.value = '';
        }

        // Enregistrement du Service Worker (PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/Meyrin-FC--FF14/service-worker.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker enregistr√© avec succ√®s:', registration.scope);
                        
                        // V√©rifier les mises √† jour
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nouvelle version disponible
                                    if (confirm('üîÑ Une nouvelle version est disponible ! Voulez-vous recharger ?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('‚ùå √âchec d\'enregistrement du Service Worker:', error);
                    });
            });

            // Recharger quand un nouveau Service Worker prend le contr√¥le
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    window.location.reload();
                    refreshing = true;
                }
            });
        }

        // D√©tection de l'installation de la PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Emp√™cher la mini-infobar par d√©faut
            e.preventDefault();
            // Stocker l'√©v√©nement pour l'utiliser plus tard
            deferredPrompt = e;
            
            // Afficher une notification personnalis√©e (optionnel)
            console.log('üí° L\'application peut √™tre install√©e !');
            
            // Vous pouvez cr√©er un bouton personnalis√© ici
            // showInstallPromotion();
        });

        // Quand l'utilisateur installe l'app
        window.addEventListener('appinstalled', () => {
            console.log('üéâ Application install√©e avec succ√®s !');
            deferredPrompt = null;
        });
    </script>
</body>
</html>
